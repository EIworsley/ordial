<!doctype html>
<meta charset="utf-8">
<title>Ordial</title>

<script type="text/javascript" src="node_modules/underscore/underscore.js"></script>
<script type="text/javascript" src="node_modules/jquery/dist/jquery.js"></script>
<script type="text/javascript" src="node_modules/backbone/backbone.js"></script>
<script type="text/javascript" src="node_modules/snapsvg/dist/snap.svg.js"></script>
<script type="text/javascript" src="node_modules/pixi.js/bin/pixi.js"></script>
<script type="text/javascript" src="/vendor/seedrandom/seedrandom.js"></script>
<script type="text/javascript" src="/templates.js"></script>

<script src="src/javascript/BinaryTreeGraphHelper.js"></script>
<script src="src/javascript/CardinalDirection.js"></script>
<script src="src/javascript/Configuration.js"></script>
<script src="src/javascript/CritterActuator.js"></script>
<script src="src/javascript/GeneMutator.js"></script>
<script src="src/javascript/OrdialScheduler.js"></script>
<script src="src/javascript/RandomNumberGenerator.js"></script>
<script src="src/javascript/RelativeDirection.js"></script>
<script src="src/javascript/Resource.js"></script>
<script src="src/javascript/ResourceSpawner.js"></script>
<script src="src/javascript/Rock.js"></script>
<script src="src/javascript/Seed.js"></script>
<script src="src/javascript/SingletonContext.js"></script>
<script src="src/javascript/StimulusPackager.js"></script>
<script src="src/javascript/SubMutator.js"></script>
<script src="src/javascript/TheVoid.js"></script>
<script src="src/javascript/World.js"></script>
<script src="src/javascript/critter/Condition.js"></script>
<script src="src/javascript/critter/Critter.js"></script>
<script src="src/javascript/critter/CritterGutsView.js"></script>
<script src="src/javascript/critter/CritterMind.js"></script>
<script src="src/javascript/critter/DecisionNode.js"></script>
<script src="src/javascript/critter/MindFactory.js"></script>
<script src="src/javascript/ordial.js"></script>
<script src="src/javascript/serializers/CritterSerializer.js"></script>
<script src="src/javascript/serializers/WorldSerializer.js"></script>
<script src="src/javascript/views/HighlightView.js"></script>
<script src="src/javascript/views/PauseView.js"></script>
<script src="src/javascript/views/ResourceView.js"></script>
<script src="src/javascript/views/RockView.js"></script>
<script src="src/javascript/views/SaveControlsView.js"></script>
<script src="src/javascript/views/SeedView.js"></script>
<script src="src/javascript/views/TimeoutControlsView.js"></script>
<script src="src/javascript/views/WorldView.js"></script>

<link rel="icon" type="image/x-icon" href="favicon.ico">

<link rel="stylesheet" type="text/css" href="src/css/ordial.css">

<div id="ordial">
  <div id="seedContainer"></div>
  <div id="pauseContainer"></div>
  <div id="timeoutControlsContainer"></div>
  <div id="world"></div>
  <div class="button" id="runCode">Run Code!</div>
  <div id="saveControlsContainer"></div>
  <div id="critterManaContainer"></div>
  <svg id="mind-graph"></svg>
</div>

<script type="text/javascript">
  $(function() {
    window.singletonContext = new SingletonContext();
    window.singletonContext.ordial = new Ordial();

    var world = window.singletonContext.world;
    $("#runCode").click(function() {
      world.initialize();
      eval($("#code").val());
    });
  });
</script>

<h3>Active Code</h3>

<textarea id="code">

    function getCoord() {
      return Math.floor(window.singletonContext.randomNumberGenerator.random() * Math.min(world.height, world.width));
    }

    function getCoords() {
      return {x: getCoord(), y: getCoord()};
    }

    for(var i = 0; i < 550; i++) {
      world.place(new Resource(), getCoords());
    }
    for(var i = 0; i < 50; i++) {
      var rock = new Rock();
      world.place(rock, getCoords());
    }

    var mindGenes =[
      ['condition', 'manaUnder300'],
      ['condition','resourceToTheRight'],
      ['condition', 'resourceInFront'],
      ['action', 'REPRODUCE'],
      ['action', 'MOVE_FORWARD'],
      ['action', 'MOVE_FORWARD'],
      ['action', 'REPRODUCE']
    ];

    var deb = new Critter({genes: mindGenes});
    deb.direction = window.singletonContext.randomNumberGenerator.sample(CardinalDirection.ALL_DIRECTIONS);
    world.place(deb, getCoords());

    var deb2 = new Critter({genes: mindGenes});
    deb2.direction = window.singletonContext.randomNumberGenerator.sample(CardinalDirection.ALL_DIRECTIONS);
    world.place(deb2, getCoords());
</textarea>
<br/>

<h3>Finding food</h3>
<textarea>
    var isSomethingInFrontOfMe = function(stimuli) {
      return stimuli.thingInFrontOfMe;
    };
    var isThingInFrontOfMeEdible = function(stimuli) {
      return stimuli.thingInFrontOfMe instanceof Resource;
    };
    var isNothingToTheLeftOfMe = function(stimuli) {
      return !stimuli.thingToTheLeftOfMe;
    };

    var turnLeftOrTurnRight = new DecisionNode(isNothingToTheLeftOfMe, Critter.Actions.TURN_LEFT, Critter.Actions.TURN_RIGHT);
    var eatItOrThink = new DecisionNode(isThingInFrontOfMeEdible, Critter.Actions.MOVE_FORWARD, turnLeftOrTurnRight);
    var moveForwardOrThink = new DecisionNode(isSomethingInFrontOfMe, eatItOrThink, Critter.Actions.MOVE_FORWARD);
    var rob = new Critter({mind: new CritterMind({decisionTree: moveForwardOrThink})});

  
  var mindGenes =[['condition', 'resourceInFront'], ['action', 'MOVE_FORWARD'],['condition','resourceToTheRight'],null,null,['action','TURN_RIGHT'],['condition','resourceToTheLeft'],null,null,['action','TURN_LEFT'],['action','REPRODUCE']];
  
  var deb = new Critter({genes: mindGenes});
  
    function getCoord() {
      return Math.floor(window.singletonContext.randomNumberGenerator.random() * 10);
    }

    function getCoords() {
      return {x: getCoord(), y: getCoord()};
    }

    for(var i = 0; i < 50; i++) {
      world.place(new Resource(), getCoords());
    }
    for(var i = 0; i < 50; i++) {
      var blocker = new Rock();
      world.place(blocker, getCoords());
    }

    rob.direction = window.singletonContext.randomNumberGenerator.sample(CardinalDirection.ALL_DIRECTIONS);
    world.place(rob, getCoords());
  
    deb.direction = window.singletonContext.randomNumberGenerator.sample(CardinalDirection.ALL_DIRECTIONS);
    world.place(deb, getCoords());
    
</textarea>

<h3>Zig Zag</h3>
<textarea>
  var zig = [Critter.Actions.TURN_RIGHT, Critter.Actions.MOVE_FORWARD, Critter.Actions.DECREMENT_COUNTER];
  var zag = [Critter.Actions.TURN_LEFT, Critter.Actions.MOVE_FORWARD, Critter.Actions.INCREMENT_COUNTER];
  var toZigOrToZagThatIsTheQuestion = function(stimuli, vitals) {
    return vitals.counter === 0;
  };
  var zigZag = new DecisionNode(toZigOrToZagThatIsTheQuestion, zig, zag);
  anna = new Critter({mind: new CritterMind({decisionTree:zigZag })});

  world.place(anna, {x:0, y: 9});
</textarea>

<h3>Turn, Run, and Make Babies</h3>
<textarea>
  rob = new Critter({mind: new CritterMind({action: Critter.Actions.MOVE_FORWARD})});
  zoe = new Critter({mind: new CritterMind({action: Critter.Actions.TURN_LEFT})});
  kim = new Critter({mind: new CritterMind({action: Critter.Actions.REPRODUCE})});
  world.place(rob, {x: 4, y: 4});
  world.place(zoe, {x: 3, y: 7});
  world.place(kim, {x: 2, y: 2});

  world.place(new Resource(), {x: 1, y: 1});
  world.place(new Resource(), {x: 3, y: 4});
</textarea>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
<script>
  $("textarea").each(function(){
    var $textarea = $(this);
    var $editarea = $("<div/>").insertAfter($textarea);
    var editor = ace.edit($editarea[0]);
    var session = editor.getSession();
    session.setValue($textarea.val());
    session.setMode("ace/mode/javascript");
    session.on('change', function(){
      $textarea.val(editor.getSession().getValue());
    });
    $textarea.hide();
  });
</script>
